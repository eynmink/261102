#include <iostream>
#include <conio.h>
#include <windows.h>
#include <string>

using namespace std;

// ‡∏Ç‡∏ô‡∏≤‡∏î‡∏â‡∏≤‡∏Å
const int WIDTH = 40;
const int HEIGHT = 15;

// ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πÇ‡∏ô
int x = WIDTH / 2;
int y = HEIGHT / 2;

// ‡πÑ‡∏ü
const int MAX_FIREBALLS = 20;

int fireX[MAX_FIREBALLS];
int fireY[MAX_FIREBALLS];
bool fireActive[MAX_FIREBALLS] = { false };

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡πÑ‡∏ü‡πÉ‡∏´‡∏°‡πà
void spawnFireball(int startX, int startY) {
    for (int i = 0; i < MAX_FIREBALLS; i++) {
        if (!fireActive[i]) {
            fireActive[i] = true;
            fireX[i] = startX;
            fireY[i] = startY + 1; // ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏´‡∏±‡∏ß
            break;
        }
    }
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏•‡∏π‡∏Å‡πÑ‡∏ü
void updateFireballs() {
    for (int i = 0; i < MAX_FIREBALLS; i++) {
        if (fireActive[i]) {
            fireY[i]++;   // ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô
            if (fireY[i] >= HEIGHT)
                fireActive[i] = false;
        }
    }
}

// ‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå
void gotoXY(int x, int y) {
    COORD c;
    c.X = x;
    c.Y = y;
    SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), c);
}

// ‡∏ß‡∏≤‡∏î‡∏â‡∏≤‡∏Å
void draw() {
    string buffer;

    for (int row = HEIGHT; row >= 0; row--) {
        for (int col = 0; col < WIDTH; col++) {

            bool drawn = false;

            // ‡∏ß‡∏≤‡∏î‡∏•‡∏π‡∏Å‡πÑ‡∏ü‡∏Å‡πà‡∏≠‡∏ô
            for (int i = 0; i < MAX_FIREBALLS; i++) {
                if (fireActive[i] && row == fireY[i] && col == fireX[i]) {
                    buffer += "|";
                    drawn = true;
                    break;
                }
            }

            if (!drawn) {
                if (row == y && col == x)
                    buffer += "ü¶ñ";
                else
                    buffer += " ";
            }
        }
        buffer += "\n";
    }

    gotoXY(0, 0);
    cout << buffer;
}

int main() {
    SetConsoleOutputCP(CP_UTF8);

    CONSOLE_CURSOR_INFO cursor;
    cursor.bVisible = false;
    cursor.dwSize = 1;
    SetConsoleCursorInfo(GetStdHandle(STD_OUTPUT_HANDLE), &cursor);

    draw();

    while (true) {
        if (kbhit()) {
            char key = getch();

            if (key == 'w' || key == 'W') y++;
            if (key == 's' || key == 'S') y--;
            if (key == 'a' || key == 'A') x--;
            if (key == 'd' || key == 'D') x++;

            // ‡∏¢‡∏¥‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î Spacebar
            if (key == 32) {
                spawnFireball(x, y);
            }

            // ‡∏Å‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏ô‡∏≠‡∏Å‡∏à‡∏≠
            if (x < 0) x = 0;
            if (x >= WIDTH) x = WIDTH - 1;
            if (y < 0) y = 0;
            if (y >= HEIGHT) y = HEIGHT - 1;
        }

        updateFireballs();  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡∏π‡∏Å‡πÑ‡∏ü‡∏ï‡∏•‡∏≠‡∏î
        draw();             // ‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡πÄ‡∏ü‡∏£‡∏°
        Sleep(10);
    }

    return 0;
}
